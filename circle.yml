machine:
  services:
    - docker
dependencies:
  cache_directories:
    - ~/.bosonstate
  override:
    - sudo chmod +x setup.sh && ./setup.sh
test:
  override:
    - sudo chmod +x get_last_commit.sh && ./get_last_commit.sh https://api.github.com/repos/Sabayon/sabayon-distro/commits/master ~/.bosonstate/current_commit
    - if [[ ! -e ~/.bosonstate/last_commit ]]; then cp -rfv ~/.bosonstate/current_commit ~/.bosonstate/last_commit; fi
    - BOSON_FROM=$(cat ~/.bosonstate/last_commit) ~/boson -c sabayon-distro-amd64.boson
    - sudo cp -rf /artifacts_dir/* $CIRCLECI_ARTIFACTS/
    - sudo mkdir -p $CIRCLECI_ARTIFACTS/logs
    - sudo cp -rf /log_dir/* $CIRCLECI_ARTIFACTS/logs/
    - cp -rfv ~/.bosonstate/current_commit ~/.bosonstate/last_commit
